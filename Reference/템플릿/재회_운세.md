# 사주 해석 템플릿 전략

## 기본 원칙

**너무 세분화하지 말고, 대표 패턴만 만들기**
- 재회 운세: 10-15개
- 만남 운세: 10-15개
- 월운: 20-30개
- 년운: 20-30개
- 일운: 10-15개

**총 예상 템플릿 개수: 70-100개 정도면 충분**

---

## 조건(conditions) 설계 예시

### 재회 운세 조건 분류 (10개 패턴)

```sql
-- 1. 합이 있고 생 관계 (최상)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('reunion',
 '{"has_hap": true, "has_saeng": true}',
 '그 사람은 당신을 기다리고 있습니다. 천간과 지지의 조화로운 기운이 강하게 작용하여 재회가 이루어질 가능성이 매우 높습니다.',
 '자신감을 가지고 먼저 연락해보세요. 따뜻한 마음으로 진심을 전하면 좋은 결과가 있을 것입니다.',
 '1개월 이내');

-- 2. 합만 있음 (긍정)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('reunion',
 '{"has_hap": true}',
 '재회의 기운이 흐르고 있습니다. 서로를 끌어당기는 힘이 있어 만남이 성사될 가능성이 있습니다.',
 '자연스럽게 접근하되, 상대방의 상황도 배려해주세요.',
 '2-3개월 이내');

-- 3. 충이 있음 (부정)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('reunion',
 '{"has_chung": true}',
 '재회는 당분간 어려울 수 있습니다. 서로 다른 방향을 바라보는 기운이 강하게 작용하고 있습니다.',
 '지금은 시간을 두고 자신을 돌아보는 것이 좋습니다. 급하게 접근하면 오히려 역효과가 날 수 있습니다.',
 '6개월 이후');

-- 4. 형이 있음 (주의)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('reunion',
 '{"has_hyeong": true}',
 '재회는 가능하지만 갈등이 재발할 가능성이 있습니다. 과거의 문제가 해결되지 않았다면 신중해야 합니다.',
 '만나기 전에 충분히 대화하고 서로의 입장을 이해하는 시간을 가지세요.',
 '3-4개월 후');

-- 5. 생 관계 (중립-긍정)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('reunion',
 '{"has_saeng": true}',
 '재회의 가능성은 열려있습니다. 서로에게 도움이 되는 관계이므로 긍정적인 만남이 될 수 있습니다.',
 '부담 없이 가벼운 만남부터 시작해보세요.',
 '2개월 이내');

-- 6. 극 관계 (부정)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('reunion',
 '{"has_geuk": true}',
 '재회 시 많은 에너지가 소모될 수 있습니다. 서로를 지치게 하는 관계일 가능성이 있습니다.',
 '재회보다는 새로운 인연에 집중하는 것을 권장합니다.',
 '당분간 어려움');

-- 7. 귀문관살 등 흉신 (부정)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('reunion',
 '{"has_흉신": true}',
 '재회는 권장하지 않습니다. 과거의 인연을 놓아주는 것이 서로에게 더 좋을 수 있습니다.',
 '미련을 버리고 앞을 보세요. 더 좋은 인연이 기다리고 있습니다.',
 '권장하지 않음');

-- 8. 천을귀인 (긍정)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('reunion',
 '{"has_천을귀인": true}',
 '귀인의 도움으로 재회가 이루어질 수 있습니다. 주변 사람의 소개나 우연한 만남의 가능성이 있습니다.',
 '주변에 도움을 요청하거나 모임에 적극 참여해보세요.',
 '1-2개월 이내');

-- 9. 원진살 (주의)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('reunion',
 '{"has_원진살": true}',
 '재회 시 오해와 갈등이 생길 수 있습니다. 의사소통에 특히 주의가 필요합니다.',
 '말보다는 행동으로 진심을 보여주세요. 솔직한 대화가 중요합니다.',
 '3개월 후');

-- 10. 기본 (특별한 신호 없음)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('reunion',
 '{}',
 '재회 여부는 당신의 노력에 달려있습니다. 사주에 특별한 긍정적 또는 부정적 신호는 보이지 않습니다.',
 '마음을 정리하고 신중하게 결정하세요. 재회를 원한다면 진심을 담아 노력해보세요.',
 '노력 여하에 따라');
```

---

## 만남 운세 조건 분류 (12개 패턴)

```sql
-- 1. 도화살 + 홍염살 (최상)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('meeting',
 '{"has_도화살": true, "has_홍염살": true}',
 '이성과의 만남 운이 최고조입니다. 매력이 넘쳐나는 시기로 좋은 인연을 만날 가능성이 매우 높습니다.',
 '적극적으로 모임에 참여하고 소개팅 제안을 받아들이세요. 첫인상에 신경쓰면 좋은 결과가 있을 것입니다.',
 '현재');

-- 2. 도화살만 (긍정)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('meeting',
 '{"has_도화살": true}',
 '새로운 인연을 만날 수 있는 좋은 시기입니다. 매력적인 사람이 주변에 나타날 가능성이 있습니다.',
 '평소보다 외모에 신경쓰고 사교 활동을 늘려보세요.',
 '1-2개월 이내');

-- 3. 천희성 (긍정)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('meeting',
 '{"has_천희성": true}',
 '기쁜 만남이 예상됩니다. 결혼으로 이어질 수 있는 좋은 인연을 만날 가능성이 있습니다.',
 '진지한 만남을 원한다면 지금이 적기입니다. 결혼정보회사나 주변의 소개를 받아보세요.',
 '2개월 이내');

-- 4. 함지살 (주의)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('meeting',
 '{"has_함지살": true}',
 '매력적이지만 위험한 인연을 만날 수 있습니다. 겉모습에 속지 않도록 주의가 필요합니다.',
 '첫인상만 보지 말고 상대방의 내면과 가치관을 충분히 알아본 후 교제를 결정하세요.',
 '신중하게');

-- 5. 고독살 + 과숙살 (부정)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('meeting',
 '{"has_고독살": true}',
 '당분간 인연을 만나기 어려운 시기입니다. 혼자 있는 것이 더 편할 수 있습니다.',
 '무리하게 만남을 찾기보다는 자기계발에 집중하세요. 때가 되면 좋은 인연이 찾아올 것입니다.',
 '6개월 이후');

-- 6. 역마살 (중립)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('meeting',
 '{"has_역마살": true}',
 '여행이나 이동 중에 인연을 만날 수 있습니다. 멀리 있는 사람과의 연이 있을 수 있습니다.',
 '여행, 출장, 온라인 모임 등 평소와 다른 환경에서 만남을 시도해보세요.',
 '이동/여행 시');

-- 7. 천간합 (긍정)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('meeting',
 '{"has_천간합": true}',
 '마음이 잘 통하는 사람을 만날 수 있습니다. 대화가 즐거운 인연이 기다리고 있습니다.',
 '취미 모임이나 스터디 그룹 등 공통 관심사를 가진 사람들과 만나보세요.',
 '1개월 이내');

-- 8. 지지합 (긍정)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('meeting',
 '{"has_지지합": true}',
 '안정적이고 편안한 인연을 만날 수 있습니다. 오래 지속될 수 있는 관계입니다.',
 '주변의 소개를 받거나 친구 모임에 참여해보세요.',
 '2개월 이내');

-- 9. 공망 (부정)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('meeting',
 '{"has_공망": true}',
 '만남이 있어도 허무하게 끝날 가능성이 있습니다. 기대만큼 좋은 결과가 나오지 않을 수 있습니다.',
 '기대치를 낮추고 자연스럽게 흘러가도록 두세요. 억지로 관계를 만들지 마세요.',
 '당분간 어려움');

-- 10. 일간이 강함 (긍정)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('meeting',
 '{"일간강도": "강"}',
 '자신감 넘치는 당신의 모습이 이성에게 매력적으로 보입니다. 주도적으로 만남을 이끌어가세요.',
 '적극적으로 다가가고 먼저 고백하세요. 망설이지 말고 행동하는 것이 좋습니다.',
 '현재');

-- 11. 일간이 약함 (주의)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('meeting',
 '{"일간강도": "약"}',
 '상대방에게 끌려다니기 쉬운 시기입니다. 자신의 주관을 잃지 않도록 주의하세요.',
 '상대방의 말만 듣지 말고 내 감정과 생각을 솔직히 표현하세요. 평등한 관계를 만드세요.',
 '신중하게');

-- 12. 기본 (특별한 신호 없음)
INSERT INTO interpretation_template (template_type, conditions, interpretation_text, advice, best_period) VALUES
('meeting',
 '{}',
 '만남의 운은 평범한 수준입니다. 특별한 행운도, 불운도 없는 시기입니다.',
 '평소처럼 생활하되 주변에 관심을 기울이세요. 일상 속에서 인연을 발견할 수 있습니다.',
 '일상 속에서');
```

---

## 조건 매칭 로직 (Python/Node.js)

```python
# Python 예시
def get_interpretation(query_type, saju_result):
    """
    사주 결과에 맞는 해석 템플릿을 조회
    """
    # 1. 사주 분석하여 조건 추출
    conditions = analyze_saju_conditions(saju_result)
    # 예: {"has_hap": true, "has_saeng": true}

    # 2. 가장 일치하는 템플릿 찾기 (우선순위: 조건 많이 일치 > 기본)
    query = """
        SELECT * FROM interpretation_template
        WHERE template_type = %s
        ORDER BY
            CASE
                WHEN JSON_CONTAINS(conditions, %s) THEN 1
                WHEN conditions = '{}' THEN 99
                ELSE 50
            END
        LIMIT 1
    """

    template = db.query(query, (query_type, json.dumps(conditions)))

    return template

def analyze_saju_conditions(saju):
    """
    사주를 분석하여 조건 추출
    """
    conditions = {}

    # 합 체크
    if has_천간합(saju) or has_지지합(saju):
        conditions['has_hap'] = True

    # 충 체크
    if has_천간충(saju) or has_지지충(saju):
        conditions['has_chung'] = True

    # 생 관계 체크
    if has_생관계(saju):
        conditions['has_saeng'] = True

    # 신살 체크
    if has_도화살(saju):
        conditions['has_도화살'] = True

    if has_천을귀인(saju):
        conditions['has_천을귀인'] = True

    # ... 기타 신살들

    return conditions
```

---

## 실용적 타협안: 3단계 전략

### 단계 1: MVP (최소 기능)
- **재회**: 5개 패턴만 (합, 충, 생, 흉신, 기본)
- **만남**: 5개 패턴만 (도화살, 고독살, 천간합, 역마살, 기본)
- **월운/년운**: 각 10개씩
- **총 30개 템플릿**

### 단계 2: 정식 출시
- 재회: 10개
- 만남: 12개
- 월운: 20개
- 년운: 20개
- 일운: 10개
- **총 70개 템플릿**

### 단계 3: 고도화 (출시 후)
- 사용자 피드백 수집
- 자주 나오는 사주 조합에 대해 템플릿 추가
- 프리미엄 사용자에게는 더 상세한 해석 제공
- **총 150개 템플릿**

---

## 결론

**단어 단위로 쪼개지 마세요!**
- 관리 복잡도만 증가하고 자연스러운 문장 만들기 어려움

**대표 패턴 10-20개만 만드세요!**
- 합, 충, 형, 파, 해, 생, 극, 주요 신살 조합
- 나머지는 기본 템플릿 사용

**시작은 작게, 점진적으로 확장!**
- MVP: 30개로 시작
- 피드백 받으며 추가

이 방식이라면 **혼자서도 1-2주면 충분히 만들 수 있습니다.**
